!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("cornerstone-tools"),require("cornerstone-core")):"function"==typeof define&&define.amd?define("cornerstonetools-rectangle-roi-threshold-segmentation",["cornerstone-tools","cornerstone-core"],t):"object"==typeof exports?exports["cornerstonetools-rectangle-roi-threshold-segmentation"]=t(require("cornerstone-tools"),require("cornerstone-core")):e["cornerstonetools-rectangle-roi-threshold-segmentation"]=t(e.cornerstoneTools,e.cornerstone)}(self,((e,t)=>(()=>{"use strict";var o={213:e=>{e.exports=t},353:t=>{t.exports=e}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return o[e](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};return(()=>{r.d(s,{RectangleROIThresholdSegmentation:()=>p});var e=r(353),t=r.n(e),o=r(213),n=r.n(o);const{getBoundingBoxAroundPolygon:i,getDiffBetweenPixelData:a}=t().import("util/segmentationUtils"),l=t().import("util/triggerEvent"),c=t().import("util/getLogger")("util:segmentation:operations:paintWithinThresholdInsideOrOutsideRectangle");function d(e,o){const{points:r,configuration:s}=o,{image:d}=e.detail,g=r.map((e=>[e.x,e.y])),[h,p]=i(g,d);!function(e,o,r,s,i){const d=e.detail.element,g=t().getToolState(d,"stack").data[0],{imageIds:h,currentImageIdIndex:p}=g,{segmentIndex:m}=o,{getters:u,setters:f}=t().getModule("segmentation"),I=function(e,t,o){const r=[];let s=e;for(let e=0;e<o;e++){let o=s+e;o>=t.length&&(o-=t.length),r.push({imageIdIndex:o,image:n().imageCache.imageCache[t[o]]?.image})}return r}(p,h,i.numberOfSlices),{width:x,height:b}=e.detail.image,[y,D]=r,[L,S]=s;if(!i.inside){const e=[];for(let t=0;t<I.length;t++){const{image:o,imageIdIndex:n}=I[t];if(!o){c.warn("Image is undefined, it most likely has not been cached yet.");continue}const l=u.activeLabelmapIndex(d),g=u.labelmap3D(d,l),h=u.labelmap2DByImageIdIndex(g,n,o.rows,o.columns),{pixelData:p}=h,y=p.slice();for(let e=0;e<x;e++)for(let t=0;t<r[1];t++){const n=t*x+e,r=o.getPixelData()[n]*o.slope+o.intercept;r>=i.thresholdLow&&r<=i.thresholdHigh&&(p[n]=m)}for(let e=0;e<r[0];e++)for(let t=r[1];t<s[1];t++){const n=t*x+e,r=o.getPixelData()[n]*o.slope+o.intercept;r>=i.thresholdLow&&r<=i.thresholdHigh&&(p[n]=m)}for(let e=s[0];e<x;e++)for(let t=r[1];t<s[1];t++){const n=t*x+e,r=o.getPixelData()[n]*o.slope+o.intercept;r>=i.thresholdLow&&r<=i.thresholdHigh&&(p[n]=m)}for(let e=0;e<x;e++)for(let t=s[1];t<b;t++){const n=t*x+e,r=o.getPixelData()[n]*o.slope+o.intercept;r>=i.thresholdLow&&r<=i.thresholdHigh&&(p[n]=m)}const D={imageIdIndex:n,diff:a(y,p)};e.push(D),f.updateSegmentsOnLabelmap2D(h)}for(let o=e.length-1;o>=0;o--)f.pushState(d,[e[o]]),l(d,t().EVENTS.LABELMAP_MODIFIED,{labelmapIndex:u.activeLabelmapIndex(d)});return}const v=[];for(let e=0;e<I.length;e++){const{image:t,imageIdIndex:o}=I[e];if(!t){c.warn("Image is undefined, it most likely has not been cached yet.");continue}const n=u.activeLabelmapIndex(d),r=u.labelmap3D(d,n),s=u.labelmap2DByImageIdIndex(r,o,t.rows,t.columns),{pixelData:l}=s,g=l.slice();for(let e=y;e<L;e++)for(let o=D;o<S;o++){const n=o*x+e,r=t.getPixelData()[n]*t.slope+t.intercept;r>=i.thresholdLow&&r<=i.thresholdHigh&&(l[n]=m)}const h={imageIdIndex:o,diff:a(g,l)};v.push(h),f.updateSegmentsOnLabelmap2D(s)}for(let e=v.length-1;e>=0;e--)f.pushState(d,[v[e]]),l(d,t().EVENTS.LABELMAP_MODIFIED,{labelmapIndex:u.activeLabelmapIndex(d)})}(e,o,h,p,s)}const g=t().import("base/BaseTool"),{segRectangleFillInsideCursor:h}=t().import("tools/cursors");class p extends g{constructor(e={}){super(e,{name:"RectangleROIThresholdSegmentation",strategies:{PAINT:d},cursors:{PAINT:h},configuration:{thresholdLow:200,thresholdHigh:1e3,numberOfSlices:200,inside:!0},defaultStrategy:"PAINT",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]})}applyActiveStrategy(e,t){return t.configuration=this.configuration,this.strategies[this.activeStrategy].call(this,e,t)}}})(),s=s.RectangleROIThresholdSegmentation})()));